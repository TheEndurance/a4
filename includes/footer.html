<script src="scripts/assignment4.js">
</script>
<script src="scripts/handlebars-v4.0.10.js"></script>
<script src="scripts/jquery-3.2.1.min.js"></script>
<script src="scripts/jquery-ui-1.12.1/jquery-ui.min.js"></script>


<script>
    $(document).ready(function () {


        /*
         * Common functions
         */
        function IncrementQuantity(productId) {
            var quantity = parseInt($("#quantity-" + productId).attr('value'), 10);
            $("#quantity-" + productId).attr('value', quantity + 1);
        }

        function DecrementQuantity(productId) {
            var quantity = parseInt($("#quantity-" + productId).attr('value'), 10);
            if (quantity > 1) {
                $("#quantity-" + productId).attr('value', quantity - 1);
                return true;
            }
            return false;
        }
        
        ////////////////////////////////////////////////////////////////////////////

        /*
         *  Adding Products to Cart
         */
        $("#productsRow").on("click", "button.js-product-add", function () {
            var productId = $(this).attr("data-product-id");
            var cartItem = ShoppingCart.AddToCart(ProductList.GetProductById(productId));
            if (cartItem !== null) { //New product is added to the cart
                HandleBarProductTemplate(cartItem);
            } else { //its not a new product
                IncrementQuantity(productId);
            }

        })
        ////////////////////////////////////////////////////////////////////////////

        /*
         *  Incrementing / Decrementing Product Quantity
         */
        $("#shoppingCartRow").on("click", "a.js-quantity", function () {
            var productId = $(this).attr("data-product-id");
            var direction = $(this).attr("data-dir");
            switch (direction) {
                case "up":
                    ShoppingCart.AddToCart(ProductList.GetProductById(productId));
                    IncrementQuantity(productId);
                    break;
                case "down":
                    if (DecrementQuantity(productId)) {
                        ShoppingCart.RemoveFromCart(ProductList.GetProductById(productId));
                    }
            }
            console.log(ShoppingCart.shoppingCart);

        })
        ////////////////////////////////////////////////////////////////////////////

        /*
         *  Handlebar Templating for Products
         */
        var productSource = $("#product-template").html();
        var productTemplate = Handlebars.compile(productSource);
        var productContext = {
            product: ProductList.productList
        };
        var productHtml = productTemplate(productContext);
        $("#productsRow").append(productHtml);
        ////////////////////////////////////////////////////////////////////////////

        /*
         *  Handlebar Templating for Products
         */
        function HandleBarProductTemplate(cartItem) {
            var shoppingCartSource = $("#shopping-cart-template").html();
            var shoppingCartTemplate = Handlebars.compile(shoppingCartSource);
            var shoppingCartContext = cartItem;
            var shoppingCartHtml = shoppingCartTemplate(shoppingCartContext);
            $("table#shoppingCart tbody").prepend(shoppingCartHtml);
        }
        ////////////////////////////////////////////////////////////////////////////

        /*
         *  Handlebar helpers
         */
        Handlebars.registerHelper("multiply", function (a, b) {
            return a * b;
        });
        ////////////////////////////////////////////////////////////////////////////

    })
</script>
</body>

</html>